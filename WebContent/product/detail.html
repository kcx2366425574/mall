<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="renderer" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>
       				
	<link rel="canonical" href="https://detail.tmall.com/item.htm?id=608799535574" />
	<link rel="amphtml" hreflang="zh-Hans" href="https://www.taobao.com/list/item-amp/608799535574.htm" />
	<link rel="alternate" hreflang="zh-Hant" href="https://world.taobao.com/item/608799535574.htm" />
    <link rel="shortcut icon" href="//img.alicdn.com/tfs/TB1XlF3RpXXXXc6XXXXXXXXXXXX-16-16.png" type="image/x-icon"/>
	<link rel="stylesheet" href="../js/layui/css/layui.css" />
                        

                

    <!-- globalmodule version: 3.0.84 -->
	<link rel="stylesheet" href="//g.alicdn.com/??mui/global/3.0.31/global.css,tm/shop/3.2.20/app.css,tm/shop/3.2.20/page/detail.css"/>
	<script src="//g.alicdn.com/secdev/pointman/js/index.js" app="tmall"></script>

    <script async src="//g.alicdn.com/sd/sufei/0.3.103/app/common/sufei-seed.js"></script>
    <link rel="stylesheet" href="//g.alicdn.com/??tm/detail/1.11.50/app.css,tm/detail/1.11.50/page/itemDetail.css"/>
    <script src="//g.alicdn.com/??tm/detail/1.11.50/app.js,tm/detail/1.11.50/page/itemDetail.js"></script>
    <link rel="stylesheet"  href="//g.alicdn.com/shop/taesite/0.1.7/platinum/stylesheet/??common/mods/ww-hover/default-min.css,view/layout-tmall-990-min.css,common/modules-sys-tmall-default-min.css,common/modules-other-tmall-default-min.css"/>
	
    <meta name="spm-id" content="a220o" />
	<meta name="referrer" content="always">
	<meta name="microscope-data" content="pageId=1728340728;prototypeId=2;siteId=2; shopId=535406143; userid=2206400142011;">
	            
 
    <Script type="text/javascript" charset="utf-8" src="//g.alicdn.com/mui/beautysku/1.0.1/index-pc.js"></Script>
 
 

    

    <script src="//g.alicdn.com/tb/pmp/2.88.6/config.js"></script> 
	<link rel="stylesheet" href="//g.alicdn.com/tb/pmp/2.88.6/c/sku/tmall.css">


</head>
<body class="  no7day"  data-spm="1000855" >



    
   <div data-spm="1998132232" id="J_dingtian">
    			
	    </div>
    

            <div id="page">
				<div id="content" data-cat="J_Cat" data-type="normal">
				


	
	
					<div id="detail">
						<div id="J_DetailMeta" class="tm-detail-meta tm-clear">
							<div class="tm-clear">
	
		
								<div class="tb-property">
			        				<div class="tb-wrap">
		    			
										<div class="tb-detail-hd">
	    
	  
											<h1 data-spm="1000983" id="info">	
											</h1>
	                                    </div>
									 
										<div class="tb-meta">
		     	        					<dl class="tm-delivery-panel" id="J_RSPostageCont"><dt class="tb-metatit">邮寄地址</dt>
			     	        					<dd>
				            						<div class="tb-postAge">
										                <span id="J_AddrSelectTrigger" class="mui_addr_tri" ></span>
										                <div id="J_PostageToggleCont" class="tb-postAge-info"></div>
										            </div>
			                    				</dd>
		     	        					</dl>
		     	        					
		     	        					<dl class="tm-delivery-panel"><dt class="tb-metatit">价格</dt>
			     	        					<dd>
				            						<div class="tb-postAge">
										                <span id="price" class="mui_addr_tri" style="color: red;"></span>
										                <div id="J_PostageToggleCont" class="tb-postAge-info"></div>
										            </div>
			                    				</dd>
		     	        					</dl>
			    	 
										</div>
		
									  	<div class="tb-key">
											<div class="tb-skin">
									    		<div class="tb-sku">
		   
													<dl class="tb-prop tm-sale-prop tm-clear tm-img-prop ">
														<dt class="tb-metatit">详细图片</dt>
														<dd>
															<ul data-property="详细图片" class="tm-clear J_TSaleProp tb-img" id="pics">
					
							  									
								    						</ul>
														</dd>
													</dl>
												    
		        									<!--<div class="tb-action">
														<div  class="tb-btn-buy tb-btn-sku" >
		                    								<a id="J_LinkBuy" href="javascript:void(0)" οnclick="buy()">立即购买</a>
		                								</div>
								        			</div>-->
								        			<!--<a id="J_LinkBuy" href="javascript:void(0)" οnclick="alert('方式1, 执行一段代码.')" class="layui-btn layui-btn-danger">立即购买</a>--> 
								        			<input type="button" value="立即购买" class="layui-btn layui-btn-danger" id="J_LinkBuy"/>
								            	</div>
								        	</div>
										</div>
    								</div>
								</div>
							
								<div data-spm="1997427645" class="tb-gallery">			
			
									<div class="tb-booth">
										<a href="javascript:void(0);">
											<img id="J_ImgBooth" data-hasZoom="700"    />
										</a>
									</div>
									
								</div>
	
							</div>
		
						</div>
					</div>
		
				</div>
			</div>
	
		</div>  
	</div>
    <script type="text/javascript" src="../js/jquery.js" ></script>
    <script type="text/javascript" src="../js/param.js" ></script>
    <script type="text/javascript" src="../js/global.js" ></script>
    <script type="text/javascript" src="../js/layui/layui.all.js" ></script>
    <script type="text/javascript">
    	
    	var container = $('#pics');
    	var picProId = getParam('proId');
    	var account ;
    	var cusId ;

    	//动态生成图片列表
		$.ajax({
			type:"get",
			url:baseUrl + "/pic/queryByPicProId",
			async:true,
			data:{picProId:picProId},
			dataType:'json'
		})
		.done(function(data,status,xhr){
			var picArray = data;
			for (var index = 0;index<picArray.length;index++) {
				var str =  "<li>\
								<img onclick='javascript:fun(this.src);' style='height: 40px; width: 40px;' href='#' id='img" + `_${index}'`  + ">\
								</img>\
							</li>"
				container.append(str);
				var imgs = $('#img'+`_${index}`);
				imgs.attr("src",picArray[index].picInfo);
			}
		})
		.fail(function(xhr,errorStatus,errorText){
			alert(errorStatus + ',' + errorText);
			layer.closeAll(); //关闭加载
		});
			
		//得到用户id
		$.ajax({
			type:"post", //请求类型get post
			url: baseUrl+"/customer/getId", //请求url地址
			async:false, //true默认表示异步请求
			dataType:'text', //响应的数据类型
		})
		.done(function(data,status,xhr){ //请求成功回调函数
			cusId = data;
		})
		.fail(function(xhr,errorStatus,errorText){ //请求失败回调函数
			alert(errorStatus + ',' + errorText);				
		});
		
		$.ajax({
			type:"post", //请求类型get post
			url: baseUrl+"/cusEx/getCusExById", //请求url地址
			data:{ceCusId:cusId},
			async:true, //true默认表示异步请求
			dataType:'json', //响应的数据类型
		})
		.done(function(data,status,xhr){ //请求成功回调函数
			$('#J_AddrSelectTrigger').text("至:    "+data.ceCusAddress);
			
		})
		.fail(function(xhr,errorStatus,errorText){ //请求失败回调函数
			alert(errorStatus + ',' + errorText);				
		});
		
		//得到商品信息
		$.ajax({
			type:"post", //请求类型get post
			url: baseUrl+"/product/queryTotalById", //请求url地址
			async:false, //true默认表示异步请求
			dataType:'json', //响应的数据类型
			data:{proId:picProId},
		})
		.done(function(data,status,xhr){ //请求成功回调函数
			$('#J_ImgBooth').attr("src",data.proPic);
			$("#price").text(data.proPrice);
			
		})
		.fail(function(xhr,errorStatus,errorText){ //请求失败回调函数
			alert(errorStatus + ',' + errorText);				
		});
		
		
		
		//单击购买按钮
		$('#J_LinkBuy').click(function(){
			
			layer.confirm('确定购买吗?', {icon: 3, title:'提示'}, function(index){
			    //do something
			    //得到用户信息
				$.ajax({
					type:"post", //请求类型get post
					url: baseUrl+"/customer/getByCusId", //请求url地址
					async:false, //true默认表示异步请求
					dataType:'json', //响应的数据类型
					data:{cusId:cusId},
				})
				.done(function(data,status,xhr){ //请求成功回调函数
					account = data.cusAccount;
				})
				.fail(function(xhr,errorStatus,errorText){ //请求失败回调函数
					alert(errorStatus + ',' + errorText);				
				});
				
				if($("#price").text()>account){
					layer.confirm('您的余额不足，是否前往充值?', {icon: 3, title:'提示'}, function(index){
						// 利用iframe加载其他网页内容到页面层 type:2
						layer.open({
							title:'余额充值',
						    type: 2, 				   
						    area: ['400px', '400px'], //宽高
						    content: '../customer/charge.html?cusId='+cusId+'&proId='+picProId
						});
					});
					return;
				}		
				
				//修改用户余额
				$.ajax({
					type:"post", //请求类型get post
					url: baseUrl+"/customer/updateMoney", //请求url地址
					async:true, //true默认表示异步请求
					dataType:'json', //响应的数据类型
					data:{cusAccount:account-$("#price").text()},
				})
				
				
				//修改商品状态
				$.ajax({
					type:"post", //请求类型get post
					url: baseUrl+"/product/updateState", //请求url地址
					async:true, //true默认表示异步请求
					dataType:'json', //响应的数据类型
					data:{proId:picProId},
				})
			    layer.close(index);
			    layer.msg('购买成功！', {icon: 6});
			    setTimeout(function() {
					location.href = '../customer/customerMain.html';//延迟跳转
				}, 1000);
				
				//生成商品流水记录
			});
			
			
			
		});	
			
    </script>
    
    <script type="text/javascript">
    	
    	
    	
		function fun(src){
		    $('#J_ImgBooth').attr("src",src);
		}
		

		
		
		
	</script>
</body>
</html>

